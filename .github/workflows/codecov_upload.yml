name: codecov_upload

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]
  workflow_run:
    workflows: ["backend", "frontend"]
    types: [completed]

permissions:
  contents: read

jobs:
  upload_coverage:
    runs-on: ubuntu-latest
    steps:
      - name: Download backend coverage artifact
        uses: actions/download-artifact@v3
        with:
          name: coverage-backend
          path: coverage.cobertura.xml
      - name: Upload backend coverage report
        uses: codecov/codecov-action@eaaf4bedf32dbdc6b720b63067d99c4d77d6047d # v3.1.4
        with:
          files: coverage.cobertura.xml
          flags: backend
          name: Backend
      - name: Download frontend coverage artifact
        uses: actions/download-artifact@v3
        with:
          name: coverage-frontend
          path: clover.xml
      - name: Upload frontend coverage report
        uses: codecov/codecov-action@eaaf4bedf32dbdc6b720b63067d99c4d77d6047d # v3.1.4
        with:
          files: clover.xml
          flags: frontend
          name: Frontend
