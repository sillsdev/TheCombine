---
- name: List netplan configuration files
  find:
    paths: /etc/netplan
    patterns: "*.yaml"
  when: eth_optional
  register: net_config

- name: Set Ethernet I/F as optional
  lineinfile:
    path: "{{ item.path }}"
    state: present
    insertafter: "^    en[a-z]\\d"
    line: "      optional: true"
  when: eth_optional
  with_items: "{{ net_config.files }}"
  notify: Apply netplan
