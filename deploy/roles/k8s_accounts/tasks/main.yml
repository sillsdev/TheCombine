---
- name: Create directory for the service account configuration files
  file:
    path: "{{ k8s_account_cfg }}"
    state: directory
    mode: 0700

- name: Create service account and role configuration files
  template:
    src: "{{ item }}.j2"
    dest: "{{ k8s_account_cfg }}/{{ item }}"
    mode: 0600
  loop: "{{ k8s_account_templates }}"
  tags:
    - config_only

- name: Create the service accounts and roles
  command: kubectl --kubeconfig={{ kubecfg }} apply -f {{ item }}
  args:
    chdir: "{{ k8s_account_cfg }}"
  loop: "{{ k8s_account_templates }}"
