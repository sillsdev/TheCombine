---
- name: Create directory for The Combine configuration files
  file:
    path: "{{ k8s_combine_cfg }}"
    state: directory
    mode: 0700

- name: Create Kubernetes configuration files
  template:
    src: "{{ item }}"
    dest: "{{ k8s_combine_cfg }}/{{ item | basename | regex_replace('^(.*\\.yaml)\\.j2', '\\1') }}"
    mode: 0600
  with_fileglob:
    - "templates/*.yaml.j2"
  notify: update thecombine
