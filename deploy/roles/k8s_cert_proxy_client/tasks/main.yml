---
- name: Create cert proxy client to fetch NUC certificates
  import_role:
    name: k8s_make_resources
  vars:
    parent_name: Create Cert Proxy Client
    k8s_config_dir: "{{ k8s_cert_proxy_cfg }}"
    k8s_templates: "{{ cert_proxy_attr.client_templates }}"

# aws_login_job requires a namespace,
# aws_namespace, that will contain containers whose images
# are pulled from AWS ECR. It also needs a service_account
# that will be used by the jobs to get the AWS credentials
- name: Setup container registry credentials
  import_role:
    name: aws_login_job
  vars:
    aws_namespace: "{{ cert_proxy_namespace }}"
    aws_service_account: "{{ k8s_service_accounts.ecr_login }}"
