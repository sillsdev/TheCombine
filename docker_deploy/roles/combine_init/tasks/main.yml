---
############################################
# Role: combine_init
#
# Role to perform initialization of TheCombine once it has been installed on
# the target system
############################################

- name: create initialization docker-compose file
  template:
    src: docker-compose.init.yml.j2
    dest: "{{ source_dir }}/docker-compose.init.yml"
    owner: root
    group: root
    mode: 0600

- name: create backend init .env file
  template:
    src: env.backend.init.j2
    dest: "{{ source_dir }}/.env.backend.init"
    owner: root
    group: root
    mode: 0600

- name: run the initialization
  command: docker-compose -f docker-compose.yml -f docker-compose.init.yml up backend
  args:
    chdir: "{{ source_dir }}"
