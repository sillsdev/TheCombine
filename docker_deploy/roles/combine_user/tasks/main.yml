---

# create the group for the combine user
- name: create group for combine app
  group:
    name: "{{ combine_group }}"
    state: present

# create the combine user
- name: create user for combine app
  user:
    name: "{{ combine_user }}"
    state: present
    password: "{{ combine_password }}"
    group: "{{ combine_group }}"
    groups:
      - docker
    shell: /bin/bash
    append: yes
    generate_ssh_key: yes

- name: Add current user as authorized user for combine_user
  authorized_key:
    user: "{{ combine_user }}"
    state: present
    key: "{{ lookup('file', '{{ item }}') }}"
  with_fileglob:
    - "{{ lookup('env', 'HOME')}}/.ssh/*.pub"
    
